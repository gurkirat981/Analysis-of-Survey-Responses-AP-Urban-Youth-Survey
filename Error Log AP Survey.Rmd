---
title: "AP Youth Survey"
author: "Vaibhav Parik"
date: "2023-01-19"
output:
  pdf_document:
    toc: yes
    number_sections: yes
fontsize: 11pt
geometry: margin=1in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(readxl)
library(writexl)
library(haven)
library(readr)
library(dplyr)
library(cowplot)
library(tidyverse)
library(ggplot2)
library(MASS)
library(ggrepel)
library(RColorBrewer)
library(stargazer)
library(DeclareDesign)
library(texreg)
library(car)
library(lubridate)
library(scales)
library(cowplot)
library(writexl)
library(janitor)
library(gridExtra)
library(grid)
library(ggpubr)
library(kableExtra)
library(data.table)
library(foreign)
library(readxl)


#Main Files ####
AP_Youth_Survey <- read_excel("/Users/gurkirat/Desktop/Archive-2/youth_survey_responses (27th Jan).xlsx")
AP_Household_Roster <- read_excel("/Users/gurkirat/Desktop/Archive-2/Household Roster Youth Survey (27th Jan).xlsx")
AP_Outmigration_Roster <- read_excel("/Users/gurkirat/Desktop/Archive-2/Outmigration Roster Youth Survey (27th Jan).xlsx")


#Codebooks ####
AP_Youth_Survey_Codebook <- read_excel("AP_Youth_Survey_Codebook.xlsx")
colnames(AP_Youth_Survey) <- AP_Youth_Survey_Codebook$Variable_Name
attr(AP_Youth_Survey, "variable.labels") <- AP_Youth_Survey_Codebook$Column_Name

AP_Household_Roster_Codebook <- read_excel("AP_Youth_Survey_Codebook.xlsx", sheet = 2)
colnames(AP_Household_Roster) <- AP_Household_Roster_Codebook$Variable_Name
attr(AP_Household_Roster, "variable.labels") <- AP_Household_Roster_Codebook$Column_Name

AP_Outmigration_Roster_Codebook <- read_excel("AP_Youth_Survey_Codebook.xlsx", sheet = 3)
colnames(AP_Outmigration_Roster) <- AP_Outmigration_Roster_Codebook$Variable_Name
attr(AP_Outmigration_Roster, "variable.labels") <- AP_Outmigration_Roster_Codebook$Column_Name


AP_Youth_Survey_Merged <- merge(AP_Youth_Survey, AP_Household_Roster[AP_Household_Roster$H_1 == "Self",], by.x = c("_uuid"), by.y = c("_submission__uuid"))
attr(AP_Youth_Survey_Merged, "variable.labels") <- c(AP_Youth_Survey_Codebook$Column_Name, AP_Household_Roster_Codebook$Column_Name[AP_Household_Roster_Codebook$Column_Name != "_submission__uuid"])

#Wrapping functions
wrap.it <- function(x, len)
{ 
  sapply(x, function(y) paste(strwrap(y, len), 
                              collapse = "\n"), 
         USE.NAMES = FALSE)
}

wrap.labels <- function(x, len)
{
  if (is.list(x))
  {
    lapply(x, wrap.it, len)
  } else {
    wrap.it(x, len)
  }
}


```


### List of flags encountered so far

#### 1. Absence of Self Respondents

We found that there are certain surveys which do not have any member of the household identified as the true respondent. According to the data by Jan 23, there are 21 such households. In total, there are about 64 respondents, once we remove children below 19, among which there are 21 true respondents who need to be identified through the face pages. Details on the same from the roster can be found below, and these have been merged with the main survey too. 

Face page references are also needed for 1 and 2(b) in the next section##

```{r, echo=FALSE}
#Non Self data file
v <- AP_Youth_Survey$`_uuid`[(AP_Youth_Survey$`_uuid` %in% AP_Household_Roster$`_submission__uuid`[AP_Household_Roster$H_1 == "Self"]) == F]

AP_Household_Roster$H_1[AP_Household_Roster$`_submission__uuid` %in% v]

AP_Household_NonSelf <- AP_Household_Roster[AP_Household_Roster$`_submission__uuid` %in% v,]
AP_Household_NonSelf <- AP_Household_NonSelf[AP_Household_NonSelf$Age > 18,]


for(i in 1:nrow(AP_Household_NonSelf)) {
  
  AP_Household_NonSelf[i,c(39:50)] = AP_Youth_Survey[AP_Youth_Survey$`_uuid` == AP_Household_NonSelf$`_submission__uuid`[i], c(1:12)]
  
}

head(AP_Household_NonSelf[,c(1:8)])


```

#### 2. Enumerator IDs entered as Respondent IDs

There are certain cases were it seems enumerator IDs have mistakenly been entered as respondent IDs. Given the last digit of the respondent ID is restricted to being less than 5, and the overall number should not exceed beyond 2100, we flagged certain IDs which were irregular. Upon crosschecking it seemed they were indeed enumerator IDs, and we are sharing a table of such IDs and the number of such responses below. 

```{r, echo = FALSE}

table(AP_Youth_Survey$`Enumerator Code`[AP_Youth_Survey$`Enumerator Code` == AP_Youth_Survey$`Respondent ID`])

```


#### 3. Misclassification of Adults as Children

There are about 16 cases where adults above the age of 19 have been entered as children. These are shown below. While they may all not necessarily be the respondent, these people need to be reclassified based on face pages.

```{r, echo = F}

Child_MisClass <- AP_Household_Roster[AP_Household_Roster$Age > 19 & AP_Household_Roster$H_1 == "Child",]

Child_MisClass[,c(1:8)]
```

#### 4. Marital Status of Children - Gurkirat

Marital status and children crosscheck - are there a lot of children?


#### 5. Disparities between Sector and Roster Occupation - Gurkirat

Any disparities between respondent occupation and industry mentioned in the roster/survey responses


Overall- Look at errors by enumerator IDs

### Analysis Observations from the Sample

#### 1. Capturing Seasonal and Long Term Employment

Roster captures - seasonal. 
Main Survey captures long term
There are certain cases where unemployed people have been counted as employed. We see that there's a large chunk of population that has been classified as employed based on the roster, but is unemployed in the main survey. Most of these responses seem to be from those engaged in casual/daily labour or self-employed, with unpaid family worker next in line


#### 2. Inertia on willingness for skill development
The skilling questions - we do see little movement from those who have not taken skilling courses/workshops in their willingness to take them in the future. 


  

### Analysis to be replicated from Partha’s slides 
1. Education of Children to Parent’s education - Breakdown by male and female (Comparison with PLFS) - Vaibhav

```{r, echo = F}
M <- as.data.table(AP_Household_Roster)
M$UID = M$`_submission__uuid`
M$Ma <- M$Gender == "Male" & M$H_1 == "Self"
M$Fa <- M$Gender == "Female" & M$H_1 == "Self"
M$UID = M$`_submission__uuid`

Mal <- M$`_submission__uuid`[M$Ma == T]
Fal <- M$`_submission__uuid`[M$Fa == T]

Male <- M[UID %in% Mal,.(Father_Ed = H_5[H_1 == "Father"], Self_Ed = H_5[H_1 == "Self"]), by=c("UID")]

Female <- M[UID %in% Fal,.(Father_Ed = H_5[H_1 == "Father"], Self_Ed = H_5[H_1 == "Self"]), by=c("UID")]


round(100*prop.table(table(Male$Father_Ed, Male$Self_Ed), 1), 1)
round(100*prop.table(table(Female$Father_Ed, Female$Self_Ed), 1), 1)

```

Tables for occupation

```{r, echo = F}
M <- as.data.table(AP_Household_Roster)
M$UID = M$`_submission__uuid`
Male <- M[UID %in% Mal,.(Father_PA = H_6[H_1 == "Father"], Self_Ed = H_5[H_1 == "Self"]), by=c("UID")]

Female <- M[UID %in% Fal,.(Father_PA = H_6[H_1 == "Father"], Self_Ed = H_5[H_1 == "Self"]), by=c("UID")]

round(100*prop.table(table(Male$Father_PA, Male$Self_Ed), 1), 1)
round(100*prop.table(table(Female$Father_PA, Female$Self_Ed), 1), 1)

rm(M, Mal, Fal)


```


2. AP youth is not growing up in a cushy environment - Asset ownership - Gurkirat


### Sectionwise Analysis to be added
#### A
Gurkirat
1. Religion, Gender and Caste breakdown

```{r}
##Composition of households
ch <- as.data.frame (table(AP_Household_Roster$H_1)) %>% 
rename("Relationship with the respondent" = Var1) %>% 
rename ("Count" = Freq) %>% 
arrange (desc(Count))


ch %>% 
kbl(caption = "Composition of households")%>%
  kable_classic(full_width = F, html_font = "Cambria", font_size = 15)

##Gender Disaggregation of youth respondent and other members of the household (Household Roster)
g1 <- as.data.frame(table(AP_Household_Roster$Gender[AP_Household_Roster$H_1 == "Self"]))

#Male respondents: 960; Women Respondents: 999
#Note: 21 self-respondents wrongly marked 


g2 <- as.data.frame(table(AP_Household_Roster$Gender[AP_Household_Roster$H_1 == "Brother" | AP_Household_Roster$H_1 == "Child" | AP_Household_Roster$H_1 == "Father" | AP_Household_Roster$H_1 == "Father-in-law"  | AP_Household_Roster$H_1 == "Grandfather" | AP_Household_Roster$H_1 == "Grandmother" | AP_Household_Roster$H_1 == "Husband" | AP_Household_Roster$H_1 == "Mother" |AP_Household_Roster$H_1 == "Mother-in-law"|AP_Household_Roster$H_1 == "Non-Relatives (guests, servants, help, etc.)" | AP_Household_Roster$H_1 == "Other Relatives"| AP_Household_Roster$H_1 == "Other-in-laws"| AP_Household_Roster$H_1 == "Sister"| AP_Household_Roster$H_1 == "Uncle/Aunt"| AP_Household_Roster$H_1 == "Wife"]))



```



#### E
Vaibhav
1. Scheme based benefit receipts & Credit attribution (Clean Y_E_75 and associated q)

First a table for receipts, how many respondents have claimed to receive at least some benefit or the other

```{r, echo = F}

Neg_Resp <- c("No", "Don't Know", "Don't know")

vec <- c(62, 67, 72, 77, 82) + 1

c <- cbind.data.frame(Col_No = as.numeric(vec), Var_Codes = colnames(AP_Youth_Survey_Merged)[vec], Q_Name = AP_Youth_Survey_Codebook$Column_Name[vec - 1])

Yes_Resp <- Tot_Resp <- rep(NA, length(vec))

for (i in 1:nrow(c)) {
  
  t <- as.data.frame(table(AP_Youth_Survey_Merged[,c$Col_No[i]] %in% Neg_Resp))
  Yes_Resp[i] <- t$Freq[t$Var1 == F]
  Tot_Resp[i] <- sum(t$Freq, na.rm = T)
  
  
}

c <- cbind.data.frame(c, Yes_Resp, Tot_Resp)
c$Benefit_Rate = round(100*c$Yes_Resp/c$Tot_Resp, 2)

names <- c("Housing", "Education", "Health", "Cash Support", "Business Support/Loan")

bp <- barplot(c$Benefit_Rate, names.arg = names, ylim = c(0,55), border = NA, col = "dodgerblue", main = "Proportion of Respondents Covered by Schemes", xlab = "Scheme", ylab = "Percentage of Respondents")
text(bp, c$Benefit_Rate, round(c$Benefit_Rate, 1), pos = 3)
```

Now for who they attribute the credit to - Very little to centre in most cases, overwhelmingly state.
This is also because in the yes responses when we look at which scheme, it is mostly the state scheme they claim to receive benefits under
```{r, echo = F}
#Attribution
vec <- c(62, 67, 72, 77, 82) + 3

State_Att <- Cent_Att <- Both_Att <- Local_Att <- rep(NA, nrow(c))

for (i in 1:nrow(c)) {
  
  t <- as.data.frame(table(AP_Youth_Survey_Merged[,vec[i]]))
  State_Att[i] <- t$Freq[t$Var1 == "State Government"]
  Cent_Att[i] <- t$Freq[t$Var1 == "Central Government"]
  Both_Att[i] <- t$Freq[t$Var1 == "Both State and Central Government"]

}

d <- cbind.data.frame(names, State_Att = State_Att/c$Yes_Resp, Cent_Att = Cent_Att/c$Yes_Resp, Both_Att = Both_Att/c$Yes_Resp)

d[,c(2:4)] <- 100*round(d[,c(2:4)], 4)
d

```



#### F
Vaibhav
1. Primary Activity - Employment Distribution (Primary Activity) - 19-29 and 30+ (across gender)

For 29-30
```{r, echo=F}
OO_LF <- c("Attending Domestic Duties", "Student", "Others", "Retired", NA)

t <- as.data.frame(table(AP_Household_Roster$H_6[AP_Household_Roster$Age %in% 19:29 & (AP_Household_Roster$H_6 %in% OO_LF) == F]))

bp <- barplot(100*prop.table(t$Freq), names.arg = wrap.labels(t$Var1, 20), ylim = c(0,50), border = NA, col = "coral2", main = "Structure of Employment Among Youth", xlab = "Primary Activity", ylab = "Percentage of Labour Force")
text(bp, 100*prop.table(t$Freq), round(100*prop.table(t$Freq)), pos = 3)

```

For 30+

```{r, echo=F}
OO_LF <- c("Attending Domestic Duties", "Student", "Others", "Retired", NA)

t <- as.data.frame(table(AP_Household_Roster$H_6[AP_Household_Roster$Age > 30 & (AP_Household_Roster$H_6 %in% OO_LF) == F]))

bp <- barplot(100*prop.table(t$Freq), names.arg = wrap.labels(t$Var1, 20), ylim = c(0,50), border = NA, col = "coral2", main = "Structure of Employment Among Adults (30+)", xlab = "Primary Activity", ylab = "Percentage of Labour Force")
text(bp, 100*prop.table(t$Freq), round(100*prop.table(t$Freq)), pos = 3)

```
Breakdown of youth

```{r, echo=F}
OO_LF <- c("Attending Domestic Duties", "Student", "Others", "Retired", NA)

t <- as.data.frame(table(AP_Household_Roster$H_6[AP_Household_Roster$Age %in% 19:24 & (AP_Household_Roster$H_6 %in% OO_LF) == F]))

bp <- barplot(100*prop.table(t$Freq), names.arg = wrap.labels(t$Var1, 20), ylim = c(0,50), border = NA, col = "coral2", main = "Structure of Employment Among Youth", xlab = "Primary Activity", ylab = "Percentage of Labour Force")
text(bp, 100*prop.table(t$Freq), round(100*prop.table(t$Freq)), pos = 3)


OO_LF <- c("Attending Domestic Duties", "Student", "Others", "Retired", NA)

t <- as.data.frame(table(AP_Household_Roster$H_6[AP_Household_Roster$Age %in% 25:29 & (AP_Household_Roster$H_6 %in% OO_LF) == F]))

bp <- barplot(100*prop.table(t$Freq), names.arg = wrap.labels(t$Var1, 20), ylim = c(0,50), border = NA, col = "dodgerblue", main = "Structure of Employment Among Youth", xlab = "Primary Activity", ylab = "Percentage of Labour Force")
text(bp, 100*prop.table(t$Freq), round(100*prop.table(t$Freq)), pos = 3)

```

By Gender

```{r, echo=F}
OO_LF <- c("Attending Domestic Duties", "Student", "Others", "Retired")

t1 <- as.data.frame(table(AP_Household_Roster$H_6[AP_Household_Roster$Age %in% 19:29 & (AP_Household_Roster$H_6 %in% OO_LF) == F & AP_Household_Roster$Gender == "Male"]))
t1$Freq <- t1$Freq/sum(t1$Freq)

t2 <- as.data.frame(table(AP_Household_Roster$H_6[AP_Household_Roster$Age %in% 19:29 & (AP_Household_Roster$H_6 %in% OO_LF) == F & AP_Household_Roster$Gender == "Female"]))
t2$Freq <- t2$Freq/sum(t2$Freq)

t <- merge(t1, t2, by = c("Var1"))

bp <- barplot(t(100*t[,c(2:3)]), beside = T, names.arg = wrap.labels(t$Var1, 20), ylim = c(0,50), border = "white", col = c("dodgerblue","coral2"), main = "Structure of Employment Among Youth (by Gender)", xlab = "Primary Activity", ylab = "Percentage of Labour Force")

```


2. Skilling - Have you taken any course, Would any course be beneficial, If yes, do you intend to take it? - Collapse them into 3 columns from 9



#### G 
Gurkirat
All four questions to be done



### Potential Next Steps

1. Running a sample crosscheck with GSWS data to see data quality and check consistency? - Neelan to take session
2. Recode string variable values across the survey and roster
3. Merge response to skilling questions into one column, so far separated by response on primary activity
4. Other internal data checks could include?